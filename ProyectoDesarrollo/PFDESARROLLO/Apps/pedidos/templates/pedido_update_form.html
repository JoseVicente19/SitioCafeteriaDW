{% extends 'baseusuarios.html' %} 
{% load static %}

{% block title %}Editar Pedido #{{ pedido.pk }}{% endblock %}

{% block contenido %}
Â  Â  <div class="container mt-4">
Â  Â  Â  Â  <h1>Editar Pedido #{{ pedido.pk }}</h1>
Â  Â  Â  Â  
Â  Â  Â  Â  <form method="post">
Â  Â  Â  Â  Â  Â  {% csrf_token %}

Â  Â  Â  Â  Â  Â  {# ðŸš¨ MOSTRAR ERRORES GLOBALES DEL FORMULARIO PRINCIPAL #}
Â  Â  Â  Â  Â  Â  {% if form.errors %}
Â  Â  Â  Â  Â  Â  <div class="alert alert-danger">
Â  Â  Â  Â  Â  Â  Â  Â  Por favor, corrige los errores en la informaciÃ³n general del pedido.
Â  Â  Â  Â  Â  Â  Â  Â  {{ form.non_field_errors }}
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {% endif %}

Â  Â  Â  Â  Â  Â  <div class="card mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header bg-info text-white">Cabecera del Pedido</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ form.as_p }}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="card mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header bg-secondary text-white">ArtÃ­culos del Pedido</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {# ðŸš¨ MOSTRAR ERRORES GLOBALES DEL FORMSET (ArtÃ­culos) #}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% if articulos_formset.errors %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="alert alert-danger">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Hay errores en los artÃ­culos. Revise si hay filas vacÃ­as o datos incorrectos.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ articulos_formset.non_form_errors }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ articulos_formset.management_form }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="table table-striped">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Producto Comprado</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Cantidad Comprada</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Precio de Venta</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Eliminar</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {# Renderiza los artÃ­culos existentes y la fila extra #}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% for form_articulo in articulos_formset %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
                                {# ðŸš¨ COMIENZO DE LA RENDERIZACIÃ“N EXPLICITA DE CAMPOS #}
                                
                                {# Columna 1: id_producto #}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ form_articulo.id_producto }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small class="text-danger">{{ form_articulo.id_producto.errors }}</small>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>

                                {# Columna 2: cantidad #}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ form_articulo.cantidad }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small class="text-danger">{{ form_articulo.cantidad.errors }}</small>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>

                                {# Columna 3: precio_unitario #}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ form_articulo.precio_unitario }}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <small class="text-danger">{{ form_articulo.precio_unitario.errors }}</small>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
                                
                                {# Columna 4: Control de EliminaciÃ³n #}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {# Si es un artÃ­culo existente, muestra el checkbox de DELETE #}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% if form_articulo.instance.pk %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {{ form_articulo.DELETE }} Eliminar
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% else %}
                                        {# Si es una fila extra vacÃ­a (no guardada), no la marques como eliminable #}
                                        &nbsp; 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}
                                    {# Renderiza los campos ocultos del formulario, incluyendo el ID #}
                                    {% for hidden in form_articulo.hidden_fields %}
                                        {{ hidden }}
                                    {% endfor %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% endfor %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary btn-lg">Guardar Cambios</button>
Â  Â  Â  Â  Â  Â  <a href="{% url 'pedidos:pedido_list' %}" class="btn btn-secondary btn-lg">Cancelar</a>

Â  Â  Â  Â  </form>
Â  Â  </div>
{% endblock %}